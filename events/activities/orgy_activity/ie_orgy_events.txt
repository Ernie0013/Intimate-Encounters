#######################
# 1001-1005 - Functionality events
# 2000+ - Regular events triggered by on_actions
# 9999 - Fallback event for when no other events trigger

namespace = ie_orgy

ie_orgy.1001 = {
	type = letter_event
	opening = ie_orgy.1001.t
	desc = ie_orgy.1001.desc
	sender = scope:host

	immediate = {
		scope:activity.activity_owner = { save_scope_as = host }
	}

  	#Yes!
	option = {
		name = ie_orgy.1001.a

		play_music_cue = "mx_cue_sacredrite"
		scope:activity = {
			accept_invitation_for_character = prev
		}
		ai_chance = {
			base = 100
			modifier = {
				add = 25
				has_trait = lustful
			}
			modifier = {
				add = 25
				has_trait = rakish
			}
			opinion_modifier = {
				opinion_target = scope:host
			}
		}
	}

	#No...
	option = {
		name = ie_orgy.1001.b

		scope:activity = {
			decline_invitation_for_character = prev
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 15
				target_is_liege_or_above = scope:host
			}
			ai_value_modifier = {
				ai_honor = 1.5
				ai_zeal = 1.5
				ai_boldness = 0.3
			}
		}
	}
}

#No guests came
ie_orgy.1002 = {
	type = character_event
	title = ie_orgy.1002.t
	desc = ie_orgy.1002.desc
	theme = seduction
	left_portrait = {
		character = root
		animation = sadness
	}

	option = {
		name = ie_orgy.1002.a
		
		scope:activity = {
			complete_activity = yes
		}
	}
}

# End for host
ie_orgy.1003 = {
	type = character_event
	title = ie_orgy.1003.t
	desc = {
		desc = ie_orgy.1003.start.desc
		desc = ie_orgy.1003.end.desc
	}
	theme = seduction
	left_portrait = {
		character = root
		animation = ecstasy
	}

	trigger = { exists = scope:activity }
	
	option = {
		name = ie_orgy.1003.a

		scope:activity = {
			every_participant = {
				limit = { NOT = { this = root } }
				trigger_event = ie_orgy.1004
			}
			complete_activity = yes
		}
	}
}

# End for guest
ie_orgy.1004 = {
	type = character_event
	title = ie_orgy.1003.t
	desc = {
		desc = ie_orgy.1004.start.desc
		desc = ie_orgy.1003.end.desc
	}
	theme = seduction
	left_portrait = {
		character = root
		animation = ecstasy
	}
	
	option = {
		name = ie_orgy.1003.a
		custom_tooltip = ie_orgy.1004.tt
	}
}


ie_orgy.2000 = {
	type = character_event
	title = ie_orgy.2000.t
	desc = {
		desc = ie_orgy.2000.desc
		triggered_desc = {
			trigger = {
				scope:orgy_character = scope:activity.activity_owner
			}
			desc = ie_orgy.2000.desc.host
		}
		triggered_desc = {
			trigger = {
				exists = scope:orgy_character2
			}
			desc = ie_orgy.2000.desc.threesome
		}
	}
	theme = seduction
	left_portrait = {
		character = scope:orgy_character
		animation = flirtation_left
	}
	right_portrait = {
		character = scope:orgy_character2
		animation = ecstasy
	}

	trigger = {
		scope:activity = {
			any_participant = {
				NOT = { this = root }
				root = {
					possibly_interested_in_character_trigger = {
						CHARACTER = prev
					}
				}
			}
		}
	}

	immediate = {
		scope:activity = {
			random_participant = {
				limit = {
					NOT = { this = root }
					root = {
						possibly_interested_in_character_trigger = {
							CHARACTER = prev
						}
					}
				}
				save_scope_as = orgy_character
			}
			if = {
				limit = { any_participant = { count > 1 } }
				random_participant = {
					limit = {
						NOR = {
							this = root
							this = scope:orgy_character
						}
					}
					save_scope_as = orgy_character2
				}
			}
		}

		carn_had_sex_with_effect = {
			CHARACTER_1 = root
			CHARACTER_2 = scope:orgy_character
			C1_PREGNANCY_CHANCE = pregnancy_chance
			C2_PREGNANCY_CHANCE = pregnancy_chance
			STRESS_EFFECTS = yes
			DRAMA = yes
		}
		if = {
			limit = { exists = scope:orgy_character2 }
			carn_had_sex_with_effect = {
				CHARACTER_1 = root
				CHARACTER_2 = scope:orgy_character2
				C1_PREGNANCY_CHANCE = pregnancy_chance
				C2_PREGNANCY_CHANCE = pregnancy_chance
				STRESS_EFFECTS = yes
				DRAMA = yes
			}
			carn_had_sex_with_effect = {
				CHARACTER_1 = scope:orgy_character
				CHARACTER_2 = scope:orgy_character2
				C1_PREGNANCY_CHANCE = pregnancy_chance
				C2_PREGNANCY_CHANCE = pregnancy_chance
				STRESS_EFFECTS = yes
				DRAMA = yes
			}
		}
	}
	
	option = {
		name = ie_orgy.2000.a
		custom_tooltip = ie_orgy.2000.tt
	}
}

# Fallback event ending orgy
ie_orgy.9999 = {
	hidden = yes

	trigger = {
		exists = scope:activity
		root = scope:activity.activity_owner
	}

	immediate = {
		trigger_event = ie_orgy.1003	
	}
}